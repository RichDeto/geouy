}
cp <- load_geouy("Centros poblados pg")
c = "Centros poblados pg"
x <- geouy::metadata
x <- x[x$capa == c,]
x <- geouy::metadata
View(x)
library(magrittr); library(dplyr)
metadata <- data.frame(
rbind(c("Areas administrativas", "SGM", "SGM", 4326, "wfs", 2011, "polnbda_ury"),
c("Departamentos", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimiteDepartamental_wfs_250000/MapServer/WFSServer"),
# c("Departamentos", "IDE", "MIDES", 32721, "wfs", 2011,
#   "https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Departamentos%20UY"),
c("Secciones", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones"),
c("Segmentos", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas"),
c("Localidades_pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg"),
# c("Area urbanizada pg", "IGM", "IGM", 4326, "wfs", 2011,
#   "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizada_wfs_20000/MapServer/WFSServer"),
# c("Area urbanizada pt", "IGM", "IGM", 4326, "wfs", 2011,
# "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizadaP_wfs_10000/MapServer/WFSServer"),
c("Centros poblados pg", "SGM", "SGM", 4326, "wfs", 2011, "builtupa"),
c("Centros poblados pt", "SGM", "SGM", 4326, "wfs", 2011, "builtupp"),
c("Municipios", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimitesMunicipales_wfs_250000/MapServer/WFSServer"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot"),
c("Lagunas públicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km")
), stringsAsFactors = FALSE)
names(metadata) <- c("capa","productor","repositor","crs","formato","anio","url")
metadata %<>% mutate(crs = as.numeric(crs), anio = as.numeric(anio))
saveRDS(metadata,"data-raw/metadata.Rds")
usethis::use_data(metadata, overwrite = TRUE)
x <- geouy::metadata
cp <- load_geouy("Secciones")
load_geouy <- function(c, crs = 32721){
x <- geouy::metadata
x <- x[x$capa == c,]
y <- ifelse(x$repositor %in% "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs))
y %>% st_transform(crs)
}
cp <- load_geouy("Secciones")
load_geouy <- function(c, crs = 32721){
x <- geouy::metadata
x <- x[x$capa == c,]
ifelse(x$repositor %in% "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs)) %>% st_transform(crs)
}
cp <- load_geouy("Secciones")
x <- x[x$capa == c,]
c= "Secciones"
x <- x[x$capa == c,]
if_else(x$repositor %in% "SGM",
st_read("WFS:http://geoservicios.sgm.gub.uy/wfsPCN1000.cgi?",x$url, crs = x$crs),
st_read(x$url, crs = x$crs)) %>%
st_transform(crs)
library(geouy)
devtools::check_rhub()
devtools::check_rhub()
devtools::check_rhub()
devtools::check_rhub()
install.packages("testthat")
library(testthat)
st_crs(load_geouy("Secciones", crs = 4326))
library(sf)
st_crs(load_geouy("Secciones", crs = 4326))
library(geouy)
st_crs(load_geouy("Secciones", crs = 4326))
a <- load_geouy("Secciones", crs = 4326)
st_crs(a)
crs(a)
epsg
is.na.crs(a)
sf::is.na.crs(a)
is.na(st_crs(a))
testthat::auto_test()
testthat::auto_test("R/plot_geouy.R")
geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453")))
geocode_ide_uy(data.frame(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"))
x <- data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"))
geocode_ide_uy(x)
class(x$dpto)
geocode_ide_uy(data.frame(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453", stringsAsFactors = F))
x <- data.frame(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453", stringsAsFactors = F)
geocode_ide_uy(x)
a <- geocode_ide_uy(x)
a
stopifnot(is.data.frame(x))
stopifnot(is.character(x$dpto), "dpto" %in% colnames(x), length(x$dpto) >= 1)
stopifnot(is.character(x$loc), "loc" %in% colnames(x))
stopifnot(is.character(x$dir), "dir" %in% colnames(x))
x <- x %>% mutate(dir = str_trim(dir)) %>% filter(nchar(dir) > 0)
library(dplyr)
library(stringi)
library(stringr)
x <- x %>% mutate(dir = str_trim(dir)) %>% filter(nchar(dir) > 0)
for (i in 1:nrow(x)) {
p <- suppressWarnings(readLines(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])))
if (length(p) == 0) {
next
}
x[i,"x"] <- as.numeric(str_sub(p, str_locate(p, "puntoX\":")[2] + 1, str_locate(p, "puntoX\":")[2] + 10))
x[i,"y"] <- as.numeric(str_sub(p, str_locate(p, "puntoY\":")[2] + 1, str_locate(p, "puntoY\":")[2] + 10))
p <- NULL
}
p <- suppressWarnings(readLines(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])))
paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"]))
paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])
p <- suppressWarnings(readLines(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])))
p <- suppressWarnings(readLines(str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20")))
readLines(str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
readLines(con = str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
readLines("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
scan("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
source("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
aa <- source("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
readChar("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
readChar("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453", 1000)
xml2::read_html("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453", 1000)
xml2::read_html("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
xml2::read_xml("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
p <- xml2::read_html("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=Montevideo&localidad=Montevideo&calle=Av.%2018%20de%20julio%201453")
as.numeric(str_sub(p, str_locate(p, "puntoX\":")[2] + 1, str_locate(p, "puntoX\":")[2] + 10))
as.numeric(str_sub(p, str_locate(p, "puntoY\":")[2] + 1, str_locate(p, "puntoY\":")[2] + 10))
read_html(str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
library(xml2)
read_html(str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
p <- suppressWarnings(read_html(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])))
paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])
p <- suppressWarnings(read_html(str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20")))
str_replace(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20")
p <- suppressWarnings(read_html(str_replace_all(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20")))
read_html(str_replace_all(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
as.numeric(str_sub(p, str_locate(p, "puntoX\":")[2] + 1, str_locate(p, "puntoX\":")[2] + 10))
geocode_ide_uy <- function(x) {
stopifnot(is.data.frame(x))
stopifnot(is.character(x$dpto), "dpto" %in% colnames(x), length(x$dpto) >= 1)
stopifnot(is.character(x$loc), "loc" %in% colnames(x))
stopifnot(is.character(x$dir), "dir" %in% colnames(x))
x <- x %>% mutate(dir = str_trim(dir)) %>% filter(nchar(dir) > 0)
for (i in 1:nrow(x)) {
p <- suppressWarnings(read_html(str_replace_all(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20")))
if (length(p) == 0) {
next
}
x[i,"x"] <- as.numeric(str_sub(p, str_locate(p, "puntoX\":")[2] + 1, str_locate(p, "puntoX\":")[2] + 10))
x[i,"y"] <- as.numeric(str_sub(p, str_locate(p, "puntoY\":")[2] + 1, str_locate(p, "puntoY\":")[2] + 10))
p <- NULL
}
return(x)
}
x <- data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"))
geocode_ide_uy(x)
x <- data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F)
geocode_ide_uy(x)
aaa <- geocode_ide_uy(data.frame(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453", stringsAsFactors = F))
as.vector(aaa)
as.vector(aaa) == c("Montevideo", "Montevideo", "Av. 18 de julio 1453", -56.1849, -34.90519)
as.vector(aaa) == c("Montevideo", "Montevideo", "Av. 18 de julio 1453", "-56.1849", "-34.90519")
aaa[4]
max( aaa[4] )
max(geocode_ide_uy(data.frame(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453", stringsAsFactors = F))[4])
max(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F))[4])
max(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F))[4])==-56.1849
56.2-0.0151
round(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F))[4])
round(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F))[4], 0)
doc_parce_raw(str_replace_all(paste0("http://servicios.ide.gub.uy/servicios/BusquedaDireccion?departamento=",
x[i,"dpto"] , "&localidad=", x[i,"loc"], "&calle=", x[i,"dir"])," ","%20"))
round(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",loc="Montevideo",dir="Av. 18 de julio 1453"), stringsAsFactors = F))[4], 0)
nchar("round(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",
loc="Montevideo",
dir="Av. 18 de julio 1453"),
stringsAsFactors = F))[4], 0)")
nchar(´round(geocode_ide_uy(data.frame(cbind(dpto="Montevideo",
loc="Montevideo",
dir="Av. 18 de julio 1453"),
stringsAsFactors = F))[4], 0)´)
library(magrittr); library(dplyr)
metadata <- data.frame(
rbind(c("Areas administrativas", "SGM", "SGM", 4326, "wfs", 2011, "polnbda_ury", NA, NA),
c("Limites departamentales", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimiteDepartamental_wfs_250000/MapServer/WFSServer",
"GLOBALID", "DEPTO"),
c("Departamentos", "IDE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/IDE/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:departamentos",
"uruguay_", "nombre"),
c("Secciones", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones",
"CODSEC","SECCION"),
c("Segmentos", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Secc MVD 2004", "INE", "MIDES", 32721, "wfs", 2004,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Secciones",
"CODSEC","SECCION"),
c("Segm MVD 2004", "INE", "MIDES", 32721, "wfs", 2004,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas MVD 2004", "INE", "MIDES", 32721, "wfs", 2004,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Segmentos URB INT 2004", "INE", "MIDES", 32721, "wfs", 2004,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Segmentos",
"CODSEG","SEGMENTO"),
c("Zonas URB INT 2004", "INE", "MIDES", 32721, "wfs", 2004,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Zonas",
"CODCOMP","ZONA"),
c("Localidades pg", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pg",
"CODLOC","NOMBLOC"),
c("Localidades pt", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=INECenso:Localidades_pt",
"CODLOC","NOMBLOC"),
# c("Area urbanizada pg", "IGM", "IGM", 4326, "wfs", 2011,
#   "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizada_wfs_20000/MapServer/WFSServer"),
# c("Area urbanizada pt", "IGM", "IGM", 4326, "wfs", 2011,
# "WFS:https://srvgis.igm.gub.uy/arcgis/services/AreaUrbanizadaP_wfs_10000/MapServer/WFSServer"),
c("Centros poblados pg", "SGM", "SGM", 4326, "wfs", 2011, "builtupa", "gml_id", "nam"),
c("Centros poblados pt", "SGM", "SGM", 4326, "wfs", 2011, "builtupp", "gml_id", "nam"),
c("Municipios", "IGM", "IGM", 4326, "wfs", 2011,
"WFS:https://srvgis.igm.gub.uy/arcgis/services/LimitesMunicipales_wfs_250000/MapServer/WFSServer",
"OBJECTID_1", "NOMBRE"),
c("Asentamientos irregulares", "PMB", "MIDES", 32721, "wfs", 2014,
"https://mapas.mides.gub.uy:443/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:ai_pmb_2014",
"cod_ast", "nom_ast"),
c("Barrios", "INE", "MIDES", 32721, "wfs", 2011,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:barrios_ine_uy",
"nrobarrio", "nombbarr"),
c("Balnearios", "MTOP", "MTOP", 4326, "wfs", 2017,
"https://geoservicios.mtop.gub.uy/geoserver/mb_planos/v_balnearios/ows?service=WFS&request=GetFeature&typeName=v_balnearios",
"id", "balneario"),
c("Cursos de agua navegables y flotables", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/cursos_nav_flot/ows?service=WFS&request=GetFeature&typeName=cursos_nav_flot",
"gml_id", "nombre"),
c("Lagunas publicas", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/rec_hidrograficos/lagunas_publicas/ows?service=WFS&request=GetFeature&typeName=lagunas_publicas",
"gml_id", "nam"),
c("Rutas", "IDE", "MIDES", 32721, "wfs", 2017,
"https://testmapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:Carreteras%20Uruguay",
"numero", "nombre"),
c("Calles", "IDE - UTE - IM", "MIDES", 32721, "wfs", 2017,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:EjesUruguayUTE,IDE:EjesMontevideoIM",
"id", "nombre"),
c("Peajes", "MTOP", "MTOP", 4326, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/peajes/ows?service=WFS&request=GetFeature&typeName=peajes",
"gml_id", "nombre"),
c("Instituciones deportivas", "IDE", "MIDES", 32721, "wfs", 2015,
"https://mapas.mides.gub.uy/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=IDE:inst_deportivas_2015",
"gml_id", "nombre"),
c("Postes Kilometros", "MTOP", "MTOP", 32721, "wfs", 2019,
"https://geoservicios.mtop.gub.uy/geoserver/inf_tte_ttelog_terrestre/postes_km/ows?service=WFS&request=GetFeature&typeName=postes_km",
NA,NA)
), stringsAsFactors = FALSE)
names(metadata) <- c("capa","productor","repositor","crs","formato","anio","url","cod","name")
metadata %<>% mutate(crs = as.numeric(crs), anio = as.numeric(anio))
# saveRDS(metadata,"data-raw/metadata.Rds")
usethis::use_data(metadata, overwrite = TRUE)
devtools::submit_cran()
devtools::submit_cran()
x1 <- sf::st_as_sf(data.frame(x = -56.184901, y = -34.905193), coords = c("x","y"), crs = 4326)
x_tiles <- tiles_ide_uy(x1)
library(geouy)
x_tiles <- tiles_ide_uy(x1)
try(if (!is(x, "sf")) stop("The object you want to process is not class sf"))
x=x1
try(if (!is(x, "sf")) stop("The object you want to process is not class sf"))
crs = sf::st_crs(x); bb = sf::st_bbox(x)
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F)
library(dplyr)
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F)
library(glue)
glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif") %>%
print()
a <- glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif") %>%
raster::stack()
a <- glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif") %>%
raster::raster()
x1 <- sf::st_as_sf(data.frame(x = -55.184901, y = -34.905193), coords = c("x","y"), crs = 4326)
x_tiles <- tiles_ide_uy(x1)
x=x1
glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif")
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F)
glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif")
class(glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif"))
a=raster::stack("https://visualizador.ide.uy/descargas/CN_Remesa_06/02_Ortoimagenes/02_RGBI_8bits/G29D5_RGBI_8_Remesa_06.tif")
a=raster::stack("https://visualizador.ide.uy/descargas/CN_Remesa_06/02_Ortoimagenes/02_RGBI_8bits/G29D5_RGBI_8_Remesa_06.tif")
a <- glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif")
raster::stack(a)
raster::stack("https://visualizador.ide.uy/descargas/CN_Remesa_06/02_Ortoimagenes/02_RGBI_8bits/H27B4_RGBI_8_Remesa_06.tif")
x1 <- sf::st_as_sf(data.frame(x = -55.184901, y = -34.905193), coords = c("x","y"), crs = 4326)
x_tiles <- tiles_ide_uy(x1)
x=x1
crs = sf::st_crs(x); bb = sf::st_bbox(x)
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F)
library(geouy)
x_tiles <- tiles_ide_uy(x1)
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F) %>% suppressMessages()
library(dplyr)
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F) %>% suppressMessages()
x2 <- suppressMessages(geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F))
a <- glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif") %>%
raster::stack() %>% raster::crop(bb)
glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif")
a <- glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif")
a <- a %>% raster::stack()
a <- a %>% raster::raster()
a <- a %>% raster::brick()
install.packages("raster")
a <- a %>% raster::stack()
library(dplyr)
a <- a %>% raster::stack()
a <- raster::stack(filename=a)
if (!file.exists(basename(a))) download.file(a, basename(a), mode = "wb")
a2 <- raster::stack(basename(a))
plot(a2)
x1 <- sf::st_as_sf(data.frame(x = c(-55.184901, -55.1901), y = c(-34.905193, -34.91)), coords = c("x","y"), crs = 4326)
crs = sf::st_crs(x); bb = sf::st_bbox(x)
a2 <- raster::stack(basename(a)) %>% raster::crop(bb)
a3 <- raster::crop(a2, bb)
a3 <- raster::crop(a2, extent(bb))
a3 <- raster::crop(a2, as(extent(bb), 'SpatialPolygons'))
a3 <- sf::st_crop(a2, bb)
bb = sf::st_bbox(x) %>% as('SpatialPolygons')
bb = sf::st_bbox(x) %>% as.vector() %>% as('SpatialPolygons')
bb = sf::st_bbox(x) %>% as.vector() %>% extent() %>% as('SpatialPolygons')
bb = sf::st_bbox(x) %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
crs(bb) <- crs(x)
crs(bb) <- raster::crs(x)
crs(bb) <- st_crs(x)
crs(bb) <- sf::st_crs(x)
sp::crs(bb) <- sf::st_crs(x)
crs(bb) <- crs
sf::crs(bb) <- crs
raster::crs(bb) <- crs
raster::crs(bb) <- crs$proj4string
a3 <- raster::crop(a2, bb)
crs = sf::st_crs(x) st_transform(5381)
crs = sf::st_crs(x) %>%  st_transform(5381)
crs = sf::st_crs(x) %>%  sf::st_transform(5381)
bb = sf::st_bbox(x) %>%  sf::st_transform(5381) %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
bb = x %>%  sf::st_transform(5381) %>% sf::st_bbox() %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
bb = x %>%  sf::st_transform(5381)
sf::st_crs(bb)
raster::crs(bb) <- "+proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs"
bb = x %>% sf::st_transform(5381) %>% sf::st_bbox() %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
raster::crs(bb) <- "+proj=longlat +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +no_defs"
a3 <- raster::crop(a2, bb)
a2 <- raster::raster(basename(a))
plot(a2)
bb = x %>% sf::st_transform(32721)
sf::st_crs(bb)
bb = x %>% sf::st_transform(32721) %>% sf::st_bbox() %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
raster::crs(bb) <- "+proj=utm +zone=21 +south +datum=WGS84 +units=m +no_defs"
a3 <- raster::crop(a2, bb)
plot(a3)
class(a3)
class(a3[1])
plot(a3[1])
plot(a2[1])
plot(a2[[1]])
basename(a)
basename(a)
a2 <- raster::brick(basename(a))
plot(a2)
sp::plot(a2)
a2 <- raster::raster(basename(a))
sp::plot(a2)
sp::plot(a3)
raster::plot(a3)
a2 <- raster::stack(basename(a))
sp::plot(a2)
x <- sf::st_as_sf(data.frame(x = c(-56.14449, -56.13936), y = c(-34.805237, -34.806787)), coords = c("x","y"), crs = 4326)
crs = sf::st_crs(x)
bb = x %>% sf::st_transform(32721) %>% sf::st_bbox() %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
raster::crs(bb) <- "+proj=utm +zone=21 +south +datum=WGS84 +units=m +no_defs"
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F)
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F)
geouy::load_geouy("Grilla ortofotos nacional", crs = crs)
library(geouy)
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F)
a <- glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif")
if (!file.exists(basename(a))) download.file(a, basename(a), mode = "wb")
if (!file.exists(basename(a))) utils::download.file(a, basename(a), mode = "wb")
if (!file.exists(basename(a))) base::download.file(a, basename(a), mode = "wb")
if (!file.exists(basename(a))) download.file(a, basename(a), mode = "wb")
if (!file.exists(basename(a))) download.file(a, basename(a), mode = "wb")
if (!file.exists(basename(a))) utils::download.file(a, basename(a), mode = "wb")
x <- sf::st_as_sf(data.frame(x = c(-56.14449, -56.13936), y = c(-34.805237, -34.806787)), coords = c("x","y"), crs = 4326)
crs = sf::st_crs(x)
bb = x %>% sf::st_transform(32721) %>% sf::st_bbox() %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
library(geouy)
bb = x %>% sf::st_transform(32721) %>% sf::st_bbox() %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
library(dplyr)
bb = x %>% sf::st_transform(32721) %>% sf::st_bbox() %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
raster::crs(bb) <- "+proj=utm +zone=21 +south +datum=WGS84 +units=m +no_defs"
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F)
a <- glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif")
if (!file.exists(basename(a))) utils::download.file(a, basename(a), mode = "wb")
a
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F) %>% filter(duplicated(nombre))
x <- sf::st_as_sf(data.frame(x = c(-56.14449, -56.13936), y = c(-34.805237, -34.806787)), coords = c("x","y"), crs = 4326)
crs = sf::st_crs(x)
bb = x %>% sf::st_transform(32721) %>% sf::st_bbox() %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
raster::crs(bb) <- "+proj=utm +zone=21 +south +datum=WGS84 +units=m +no_defs"
folder = tempdir()
# download ----
try(dir.create(folder))
crs = sf::st_crs(x)
bb = x %>% sf::st_transform(32721) %>% sf::st_bbox() %>% as.vector() %>% raster::extent() %>% as('SpatialPolygons')
raster::crs(bb) <- "+proj=utm +zone=21 +south +datum=WGS84 +units=m +no_defs"
x2 <- geouy::load_geouy("Grilla ortofotos nacional", crs = crs) %>% sf::st_join(x, left = F) %>% filter(duplicated(.data$nombre))
a <- glue::glue("https://visualizador.ide.uy/descargas/CN_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}/02_Ortoimagenes/02_RGBI_8bits/{as.character(x2$nombre)}_RGBI_8_Remesa_{stringr::str_pad(x2$remesa, 2, pad = '0')}.tif")
if (!file.exists(a)) {
message(glue::glue("Intentando descargar ECH {y}..."))
try(utils::download.file(a[h], basename(a[h]), mode = "wb", method = "libcurl"))
} else {
message(glue::glue("ECH {y} ya existe, se omite la descarga"))
}
if (!file.exists(a)) {
message(glue::glue("Intentando descargar ECH {folder}..."))
try(utils::download.file(a[h], basename(a[h]), mode = "wb", method = "libcurl"))
} else {
message(glue::glue("ECH {y} ya existe, se omite la descarga"))
}
if (!file.exists(a)) {
message(glue::glue("Intentando descargar ECH {folder}..."))
try(utils::download.file(a, basename(a), mode = "wb", method = "libcurl"))
} else {
message(glue::glue("ECH {folder} ya existe, se omite la descarga"))
}
# read_ech
ar <- fs::dir_ls(folder, regexp = "\\.tif$")
folder
# read_ech
ar <- fs::dir_ls(folder, glob = ".tif")
# read_ech
ar <- fs::dir_ls(folder, glob = ".tif")
fs::dir_ls(folder, regexp = "\\.tif$"))
fs::dir_ls(folder, regexp = "\\.tif$")
tempdir()
fs::dir_ls(tempdir())
glue::glue("{folder}//{basename(a)})"
)
if (!file.exists(a)) {
message(glue::glue("Intentando descargar ECH {folder}..."))
try(utils::download.file(a, glue::glue("{folder}\{basename(a)}"), mode = "wb", method = "libcurl"))
} else {
message(glue::glue("ECH {folder} ya existe, se omite la descarga"))
}
try(utils::download.file(a, glue::glue("{folder}//{basename(a)}"), mode = "wb", method = "libcurl"))
if (!file.exists(a)) {
message(glue::glue("Intentando descargar ECH {folder}..."))
try(utils::download.file(a, glue::glue("{folder}//{basename(a)}"), mode = "wb", method = "libcurl"))
} else {
message(glue::glue("ECH {folder} ya existe, se omite la descarga"))
}
x <- sf::st_as_sf(data.frame(x = c(-56.14449, -56.13936), y = c(-34.805237, -34.806787)), coords = c("x","y"), crs = 4326)
# checks ----
try(if (!is(x, "sf")) stop("The object you want to process is not class sf"))
if (!is.character(folder) | length(folder) != 1) {
message(glue::glue("Debe ingresar un directorio..."))
}
folder = tempdir()
if (!is.character(folder) | length(folder) != 1) {
message(glue::glue("Debe ingresar un directorio..."))
}
# warnings ----
if (length(fs::dir_ls(folder, regexp = "\\.tif$")) != 0) {
message(glue::glue("Existen en la carpeta otros archivos .tif que seran leidos..."))
}
